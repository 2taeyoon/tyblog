í˜„ì¬ ì§„í–‰ ì¤‘ì¸ í¬íŠ¸í´ë¦¬ì˜¤ ì‚¬ì´íŠ¸ì˜ ë§ˆìš°ìŠ¤ ì´í™íŠ¸ë¥¼ êµ¬í˜„í•˜ëŠ” ê³¼ì •ì—ì„œ `NextJS`ì˜ ì˜¤ë¥˜ë¥¼ í•´ê²°í•œ ë°©ë²•ì„ ê¸°ë¡í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ì´ì „ì—ëŠ” `useState`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë§ˆìš°ìŠ¤ ì›€ì§ì„ì„ ê°ì§€í•˜ê³  ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í–ˆëŠ”ë° ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í—ˆí—£..

`Maximum update depth exceeded` ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ì„œ ë¬´í•œ ë£¨í”„ì— ë¹ ì§€ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•´ì•¼ í–ˆìŠµë‹ˆë‹¤!

## âŒ Maximum update depth exceeded

```shell
Maximum update depth exceeded.
This can happen when a component calls setState inside useEffect,
but useEffect either doesn't have a dependency array,
or one of the dependencies changes on every render.
```

ğŸ“Œ **ì´ ì˜¤ë¥˜ ë¬´ì—‡..?**

ì´ ì˜¤ë¥˜ëŠ” `useEffect`ì—ì„œ `setState`ë¥¼ í˜¸ì¶œí•˜ëŠ”ë° ì˜ì¡´ì„± ë°°ì—´ì´ ì—†ê±°ë‚˜ ì˜ëª» ì„¤ì •ë˜ì–´ ë¬´í•œ ë£¨í”„ê°€ ë°œìƒí•  ë•Œ ë°œìƒí•©ë‹ˆë‹¤. ì¦‰, `ë Œë”ë§` â†’ `setState í˜¸ì¶œ` â†’ `ë‹¤ì‹œ ë Œë”ë§` â†’ `setState í˜¸ì¶œ...` ì´ëŸ° ì‹ìœ¼ë¡œ ê³„ì†í•´ì„œ ì¬ë Œë”ë§ì´ ë°˜ë³µë˜ëŠ” í˜„ìƒìœ¼ë¡œ ì¸í•œ ì˜¤ë¥˜ì…ë‹ˆë‹¤.


## ğŸ¦® ê¸°ì¡´ ì½”ë“œ (ê°œì„  ì „)

```tsx
import { Matrix } from "@/types/props";
import { useState } from "react";

const useMouseEffect = () => {
    const [gMatrix, setGMatrix] = useState<Matrix>({ a: 1, b: 0, c: 0, d: 1, e: 0, f: 0 });
    const [circleMatrix, setCircleMatrix] = useState<Matrix>({ a: 0, b: 1, c: -1, d: 0, e: 1440, f: 0 });
    const [rotation, setRotation] = useState(0);

    const handleMouseMove = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {
		// ìƒëµ...

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        setGMatrix(newGMatrix);
        setCircleMatrix(newCircleMatrix);
        setRotation(newRotation);
    };

    return { gMatrix, circleMatrix, rotation, handleMouseMove };
};
export default useMouseEffect;
```

ğŸ“Œ **ê¸°ì¡´ ì½”ë“œì˜ ë¬¸ì œì **

1. `setState`ë¥¼ `handleMouseMove` ë‚´ì—ì„œ ì§ì ‘ í˜¸ì¶œ â†’ **ë¦¬ë Œë”ë§ì´ ê³¼ë„í•˜ê²Œ ë°œìƒ**.
2. ë§ˆìš°ìŠ¤ë¥¼ ì›€ì§ì¼ ë•Œë§ˆë‹¤ `setState`ê°€ ì‹¤í–‰ë˜ë¯€ë¡œ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.
3. ë¶ˆí•„ìš”í•œ ìƒíƒœ ì—…ë°ì´íŠ¸ë¡œ ì¸í•´ UIê°€ ë¶€ë“œëŸ½ê²Œ ë Œë”ë§ë˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ¦® ê°œì„  ì½”ë“œ (requestAnimationFrame í™œìš©)

```tsx
import { useRef, useEffect, useState } from "react";

const useMouseEffect = () => {
    const gMatrixRef = useRef({ a: 1, b: 0, c: 0, d: 1, e: 0, f: 0 });
    const circleMatrixRef = useRef({ a: 0, b: 1, c: -1, d: 0, e: 1440, f: 0 });
    const rotationRef = useRef(0);

    const [gMatrix, setGMatrix] = useState(gMatrixRef.current);
    const [circleMatrix, setCircleMatrix] = useState(circleMatrixRef.current);
    const [rotation, setRotation] = useState(rotationRef.current);

    const handleMouseMove = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {
		// ìƒëµ...
    };

    // âœ… requestAnimationFrameì„ í™œìš©í•œ ì—…ë°ì´íŠ¸
    useEffect(() => {
        let animationFrameId: number;

        const updateMouseEffect = () => {
            setGMatrix({ ...gMatrixRef.current });
            setCircleMatrix({ ...circleMatrixRef.current });
            setRotation(rotationRef.current);
            animationFrameId = requestAnimationFrame(updateMouseEffect);
        };

        updateMouseEffect();

        return () => cancelAnimationFrame(animationFrameId);
    }, []);

    return { gMatrix, circleMatrix, rotation, handleMouseMove };
};
export default useMouseEffect;
```

ğŸ“Œ **ê°œì„  ì½”ë“œì˜ ì£¼ìš” ë³€ê²½ì **

1. `useRef`ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì§ì ‘ DOM ê°ì²´ë¥¼ ì¡°ì‘** â†’ ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ ì¤„ì—¬ **ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì„ ë°©ì§€í•©ë‹ˆë‹¤.**
2. `requestAnimationFrame`ì„ í™œìš©í•˜ì—¬ **ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¥¼ ì œê³µí•©ë‹ˆë‹¤.**
3. `useEffect` ë‚´ì—ì„œ `requestAnimationFrame`ì„ ì‚¬ìš©í•˜ì—¬ ì—…ë°ì´íŠ¸ë¥¼ ìµœì í™”í•©ë‹ˆë‹¤.
4. ë§ˆìš°ìŠ¤ë¥¼ ë¹ ë¥´ê²Œ ì›€ì§ì—¬ë„ í”„ë ˆì„ìœ¼ë¡œ ì• ë‹ˆë©”ì´ì…˜ì´ ì§„í–‰ë˜ì–´ ì„±ëŠ¥ ì €í•˜ê°€ ì—†ì´ ë™ì‘í•©ë‹ˆë‹¤.

***

## ğŸ¦® requestAnimationFrame(callback)ì„ ì‚¬ìš©í•œ ì´ìœ 

ğŸ“Œ **requestAnimationFrame(callback)ì´ë€?**

* ë¸Œë¼ìš°ì €ê°€ ë‹¤ìŒ í™”ë©´ì„ ê·¸ë¦´ ë•Œ ì‹¤í–‰í•  í•¨ìˆ˜ë¥¼ ë“±ë¡í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.
* ì´ˆë‹¹ 60í”„ë ˆì„ì— ë§ì¶° ìë™ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.
* ë¸Œë¼ìš°ì €ê°€ ë¹„í™œì„±í™”(íƒ­ ë¹„í™œì„± ë° ìµœì†Œí™”)ë˜ë©´ ìë™ìœ¼ë¡œ í•¨ìˆ˜ê°€ ì¤‘ë‹¨ë©ë‹ˆë‹¤. ì¦‰, ë¶ˆí•„ìš”í•œ ì—°ì‚° ë°©ì§€ ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤.

***

## 4. ê²°ë¡ 

| **ê¸°ëŠ¥**          | **ê°œì„  ì „ ì½”ë“œ** | **ê°œì„  í›„ ì½”ë“œ** |
|:------------------|:----------------|:----------------|
| **ë Œë”ë§ ìµœì í™”** | ë¦¬ë Œë”ë§ ë§ìŒ | ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€ |
| **ì„±ëŠ¥**         | ê³¼ë„í•œ `setState` | `requestAnimationFrame` ì‚¬ìš© |
| **ì• ë‹ˆë©”ì´ì…˜**   | ë²„ë²…ì„ ë°œìƒ ê°€ëŠ¥ | ë¶€ë“œëŸ¬ìš´ UI êµ¬í˜„ |

ì´ë²ˆ ê°œì„ ì„ í†µí•´ `NextJS`ì—ì„œ ë°œìƒí–ˆë˜ `Maximum update depth exceeded` ì˜¤ë¥˜ë¥¼ í•´ê²°í•˜ê³  ë” ë¶€ë“œëŸ¬ìš´ ë§ˆìš°ìŠ¤ ì´í™íŠ¸ ì• ë‹ˆë©”ì´ì…˜ì„ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ê²°ë¡ ì ìœ¼ë¡œ ì• ë‹ˆë©”ì´ì…˜ê³¼ ì„±ëŠ¥ì´ ì¤‘ìš”í•œ ê²½ìš°! `useRef` + `requestAnimationFrame`ê°€ í›¨ì”¬ ë” ì¢‹ì€ ì„ íƒì´ë€ ê±¸ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤!